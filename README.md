## 串口接收数据通讯协议

### 自定义的帧格式

```
+--------+--------+--------+-------------+----------+
| Header |  CMD   |  LEN   |   Payload   | Checksum |
+--------+--------+--------+-------------+----------+
| 0xA5   | 1 Byte | 1 Byte |  LEN Bytes  |  1 Byte  |
+--------+--------+--------+-------------+----------+
```

tips: Payload 数据传输使用大端格式

### 命令字定义

| device  | cmd  | 功能               |
| ------- | ---- | ------------------ |
| maixcam | 0x00 | 二维码             |
| maixcam | 0x01 | 条形码             |
| signal  | 0x02 | 测距距离（左中右） |
| asrpro  | 0x03 | ack                |

### STP23L 帧格式

```
+----------+------+-----+--------+--------+-----+----------+
| Preamble | ADDR | CMD | OFFSET |  LEN   | ... | Checksum |
+----------+------+-----+--------+--------+-----+----------+
| 4*0xAA   | 1B   | 1B  |   2B   |   2B   | LEN |    1B    |
+----------+------+-----+--------+--------+-----+----------+
```

**总长度**: 11 + LEN 字节

### 字段说明

-   **Preamble**: 4 个字节 `0xAA 0xAA 0xAA 0xAA`，帧头标识
-   **ADDR**: 设备地址（通常为 0）
-   **CMD**: 命令字
-   **OFFSET**: 偏移地址，小端格式（低字节在前）
-   **LEN**: 数据长度，小端格式，2 字节
-   **Payload**: 数据内容
-   **Checksum**: 校验和 = (ADDR + CMD + OFFSET + LEN + Payload) & 0xFF

### 命令字定义

| 命令字       | 值   | 功能         |
| ------------ | ---- | ------------ |
| GET_DISTANCE | 0x02 | 获取距离数据 |
| RESET_SYSTEM | 0x0D | 复位系统     |
| STOP         | 0x0F | 停止测量     |
| ACK          | 0x10 | 应答         |
| VERSION      | 0x14 | 获取版本信息 |

每帧包含 12 个测量点 + 时间戳：

```
每个点 15 字节:
  - distance (2B): 距离，int16
  - noise (2B): 环境噪声，uint16
  - peak (4B): 光强度，uint32
  - confidence (1B): 可信度，uint8
  - intg (4B): 积分次数，uint32
  - reftof (2B): 内部温度，int16

timestamp (4B): 时间戳，uint32

总共: 12*15 + 4 = 184 字节
```
